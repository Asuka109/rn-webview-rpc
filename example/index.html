<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React-Native WebView RPC Example</title>
    <script>
        // ** dirty hack **
        function initProxy() {
          if (typeof window.rnRpc !== 'undefined') {
            console.log('proxy loaded');
            window.proxy = window.rnRpc.proxy();
          } else {
            setTimeout(initProxy, 500);
          }
        }
        initProxy();
        // ****************

        async function fireNativeAlert() {
          await proxy.Alert.alert(
            'What is your favorite color?',
            'We got green and blue',
            [
              {text: 'Ask me later'},
              {text: 'Green', onPress: rnRpc.proxyValue(() => setBgColor('green'))},
              {text: 'Blue', onPress: rnRpc.proxyValue(() => setBgColor('blue'))},
            ],
            { cancelable: false }
          );
        }

        function setBgColor(color) {
          document.body.style.backgroundColor = color;
        }

        async function getNetInfo() {
          let netInfo = await await proxy.NetInfo.getConnectionInfo();
          alert(`type: ${netInfo.type}, effectiveType: ${netInfo.effectiveType}`);
        }

        // Comlink.expose({ setBgColor }, MessageChannelAdapter.wrap(
        //   {
        //       send: (data) => {console.log(data); return window.postMessage(data, '*')},
        //       addEventListener: (type, listener, options) =>
        //         document.addEventListener(type, listener, options)
        //     }
        // ));
    </script>
    <style>
        html, body, .container {
            height: 100%;
        }
        .container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <div class="container">
        <button onclick="fireNativeAlert()" style="font-size: 26px;">
            Fire a native alert
        </button>
        <div class="line-break"></div>
        <button onclick="getNetInfo()" style="font-size: 26px; margin:15px;">
            Get net info
        </button>
    </div>
</body>
</html>